# üêå SlugKiller ‚Äî High-Performance URL Shortener

**SlugKiller** ‚Äî —ç—Ç–æ –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è —Å—Å—ã–ª–æ–∫ –Ω–∞ Go, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–∞–∫ –≤ PostgreSQL, —Ç–∞–∫ –∏ –≤–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–º In-Memory-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ, —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º —á–µ—Ä–µ–∑ Redis –∏ –ª–∞–∫–æ–Ω–∏—á–Ω—ã–º REST API.

---

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å—Å—ã–ª–æ–∫**
  - –î–ª–∏–Ω–∞ —Å—Å—ã–ª–∫–∏ ‚Äî 10 —Å–∏–º–≤–æ–ª–æ–≤ (`a-zA-Z0-9_`).
  - –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (`crypto/rand`).
  - –ù–∞–¥—ë–∂–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–ª–ª–∏–∑–∏–π.

- **–ì–∏–±–∫–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –¥–∞–Ω–Ω—ã—Ö**
  - PostgreSQL –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ –∏ –Ω–∞–¥—ë–∂–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è.
  - In-Memory storage –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–æ–≤.

- **–í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
  - –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–æ–∫ —Å –ø–æ–º–æ—â—å—é Redis.

- **–ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**
  - –ß—ë—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —Å–ª–æ–∏ (`Handler ‚Üí Service ‚Üí Repository`).
  - Dependency Injection —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã.

- **–†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
  - –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ zerolog.

---

## üõ†Ô∏è –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

| –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ       | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è                 |
|------------------|----------------------------|
| –Ø–∑—ã–∫             | Go (1.21+)                 |
| HTTP-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫   | Gin                        |
| –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö      | PostgreSQL, In-Memory      |
| –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ      | Redis                      |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ      | zerolog                    |
| –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ     | testify/mock               |
| –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è  | Docker, Docker Compose     |
| –ú–∏–≥—Ä–∞—Ü–∏–∏         | golang-migrate             |

---
## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
SlugKiller/
‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îî‚îÄ‚îÄ server/               # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (main.go)
‚îÇ       ‚îî‚îÄ‚îÄ main.go
‚îú‚îÄ‚îÄ config/                   # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—á—Ç–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è)
‚îú‚îÄ‚îÄ infrastructure/
‚îÇ   ‚îú‚îÄ‚îÄ db/                   # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
‚îÇ   ‚îî‚îÄ‚îÄ redis/                # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redis
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ cache/                # –†–∞–±–æ—Ç–∞ —Å Redis (–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
‚îÇ   ‚îú‚îÄ‚îÄ handler/              # HTTP-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è gin)
‚îÇ   ‚îú‚îÄ‚îÄ model/                # –û–±—â–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ repository/           # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ (URL, Slug –∏ –¥—Ä.)
‚îÇ   ‚îú‚îÄ‚îÄ server/               # –ó–∞–ø—É—Å–∫ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ HTTP-—Å–µ—Ä–≤–µ—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ service/              # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ storage/              # –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mem/              # In-memory —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pg/               # PostgreSQL —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ init_storage.go       # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
‚îÇ   ‚îî‚îÄ‚îÄ init_storage_test.go  # –¢–µ—Å—Ç—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
‚îú‚îÄ‚îÄ internal/tests/mocks/     # –ú–æ–∫–∏ –¥–ª—è unit-—Ç–µ—Å—Ç–æ–≤ (–≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è mockery)
‚îú‚îÄ‚îÄ migrations/               # SQL-–º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ pkg/
‚îÇ   ‚îî‚îÄ‚îÄ logger/               # –û–±–µ—Ä—Ç–∫–∞ –Ω–∞–¥ zerolog
‚îú‚îÄ‚îÄ .env                      # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ docker-compose.yml        # Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ Dockerfile                # Dockerfile –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞
‚îú‚îÄ‚îÄ Dockerfile.migrations     # Dockerfile –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π
‚îú‚îÄ‚îÄ Dockerfile.tests          # Dockerfile –¥–ª—è —Ç–µ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ go.mod
‚îú‚îÄ‚îÄ go.sum
‚îú‚îÄ‚îÄ Makefile                  # –ö–æ–º–∞–Ω–¥—ã —Å–±–æ—Ä–∫–∏, –∑–∞–ø—É—Å–∫–∞ –∏ —Ç–µ—Å—Ç–æ–≤
‚îî‚îÄ‚îÄ README.md                 # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞

```


---

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone https://github.com/Thoustick/SlugKiller.git
cd SlugKiller
```

# HTTP Server
HTTP_ADDR=:8080

# Storage (postgres –∏–ª–∏ memory)
STORAGE_TYPE=memory

# PostgreSQL
DB_HOST=postgres
DB_PORT=5432
DB_USER=user
DB_PASSWORD=password
DB_NAME=slugkiller
DATABASE_URL=postgres://${DB_USER}:${DB_PASSWORD}@${DB_HOST}:${DB_PORT}/${DB_NAME}?sslmode=disable
DB_TIMEOUT_SECONDS=15

# Redis
REDIS_HOST=redis:6379
REDIS_PASSWORD=
REDIS_DB=0
CACHE_TTL_HOURS=0

# Slug settings
SLUG_LENGTH=10
MAX_ATTEMPTS=5

# Logger
LOG_LEVEL=debug|info|warn|error|fatal


## üõ†Ô∏è –ó–∞–ø—É—Å–∫

### üöß Run with In-Memory Storage

```bash
docker-compose up --build
```

### üß™ Run with PostgreSQL

```bash
STORAGE_TYPE=postgres docker-compose --profile postgres up --build
```
### Run Tests

```bash
docker-compose -f docker-compose.test.yml up --build --abort-on-container-exit
```


## üì´ API Endpoints

### 1. POST `/shorten`

–°–æ–∫—Ä–∞—Ç–∏—Ç—å —Å—Å—ã–ª–∫—É:

```http
POST /shorten
Content-Type: application/json

{
  "url": "https://example.com/very-long-url"
}
```

**–û—Ç–≤–µ—Ç:**

```json
{
  "slug": "AbC12_xYZ3"
}
```

### 2. GET `/{slug}`

–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ —Å–æ–∫—Ä–∞—â—ë–Ω–Ω–æ–π —Å—Å—ã–ª–∫–µ:

```http
GET /AbC12_xYZ3
```

**–û—Ç–≤–µ—Ç:**

```
302 Found ‚Üí Location: https://example.com
```

## ‚úÖ –õ–æ–∫–∞–ª—å–Ω—ã–µ –¢–µ—Å—Ç—ã

```bash
go test -v -cover ./...
```

–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–∞ –ø–æ–∫—Ä—ã—Ç–∏—è:

```bash
go tool cover -html=coverage.out -o coverage.html
```

### üõ†Ô∏è Makefile Commands

| –ö–æ–º–∞–Ω–¥–∞         | –û–ø–∏—Å–∞–Ω–∏–µ                                  |
|------------------|--------------------------------------------|
| `make build`     | –°–±–æ—Ä–∫–∞ –≤—Å–µ—Ö Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤            |
| `make run`       | –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞ —Å In-Memory —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º     |
| `make run-pg`    | –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞ —Å PostgreSQL               |
| `make test`      | –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö unit-—Ç–µ—Å—Ç–æ–≤                   |
| `make migrate`   | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö         |
| `make clean`     | –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∏ –æ–±—Ä–∞–∑–æ–≤       |
